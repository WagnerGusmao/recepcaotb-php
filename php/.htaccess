RewriteEngine On

# Habilitar CORS
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"

# Tratar requisições OPTIONS
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# Roteamento para APIs
RewriteRule ^api/auth/?(.*)$ api/auth.php [QSA,L]
RewriteRule ^api/pessoas/?(.*)$ api/pessoas.php [QSA,L]
RewriteRule ^api/frequencias/?(.*)$ api/frequencias.php [QSA,L]
RewriteRule ^api/usuarios/?(.*)$ api/usuarios.php [QSA,L]
RewriteRule ^api/voluntarios/?(.*)$ api/voluntarios.php [QSA,L]
RewriteRule ^api/frequencia_voluntarios/?(.*)$ api/frequencia_voluntarios.php [QSA,L]

# Removido: Regra catch-all que redirecionava para index.html
# Essa regra estava impedindo o acesso correto às APIs
# RewriteCond %{REQUEST_FILENAME} !-f
# RewriteCond %{REQUEST_FILENAME} !-d
# RewriteRule ^(.*)$ ../index.html [L]

# Configurações de segurança
<Files ".env">
    Order allow,deny
    Deny from all
</Files>

<Files "composer.json">
    Order allow,deny
    Deny from all
</Files>

<Files "composer.lock">
    Order allow,deny
    Deny from all
</Files>

# Configurações PHP
php_value upload_max_filesize 50M
php_value post_max_size 50M
php_value memory_limit 256M
php_value max_execution_time 300
